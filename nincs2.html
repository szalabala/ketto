<!DOCTYPE html>
<html>
<head>
  <title>Nincs2 párkereső</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="viewport" content="minimal-ui,width=device-width, initial-scale=1">
  <meta charset="UTF-8">
<style>
.debug { display:none }
html, body {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  height: -webkit-fill-available;
  width: -webkit-fill-available;
  -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
            user-select: none; /* Non-prefixed version, currently
                                  supported by Chrome, Edge, Opera and Firefox */
}
h2 { font-size:5vmin; } 
.xl { font-size:10vmin; font-weight: bolder; }
.big { font-size:5vmin }
.medium { font-size:4vmin }
.small { font-size:3vmin }
.icon { height:13vmin;width:13vmin;max-height:15vh;max-width:15vw; }
.bigicon { height:20vmin;width:20vmin;max-height:25vh;max-width:25vw; }
.rotate { transition: transform 2s linear; }  
p { margin:auto; padding:0;font-size:3vmin; border-radius:25%; }
body { background-image:url("images/csempe.jpg"); overflow: hidden; }
table, tr, td { border: none; padding:0; margin:0; text-align: center; }
img.mozgo { position: absolute; left: 0px; top: 0px; display:inline-block;}
img.top { z-index: 3; }
img.med { z-index: 2; }
img.back { z-index: 1; }
.modebutton { border: 5px solid red;  border-radius:25%; padding:1%; margin:1%; text-align: center; }
@keyframes blink1{
  0%{ transform: scale(1,1); }
  5%{ transform: scale(1.05,1.05); }
  10%{ transform: scale(1,1); }
}
@keyframes blink2{
  0%{ transform: scale(1,1); }
  10%{ transform: scale(1.2,1.2); }
  20%{ transform: scale(1,1); }
}
</style>
<script>
    var _name = "Nincs Kettő Négy Nélkül";
    var _version = '0.9.7';
    var _fps = 10;
    var _shortMs = 500;
    var _longMs = 1500;
    var gameDesc = { maxPair: 12, numLongEdge: 6, numShortEdge: 3
        , W: 6
        , H: 3
        , dice: 4
        , start_message: "<span style=\"color:blue;text-decoration:blink;\">" + "lovas" + "</span>"
        , restart_message: "<span style=\"color:blue;text-decoration:blink;\">Kattints a Puffinra az újrakezdéshez</span>"
        , tabla: "kincsaminincs-terkep1000d.jpg", tabla0: "images/nincs2header_46d.jpg", tabla_end: "ending.jpg"
        , music: "audio/movin-cruisin-xylo.mp3", music0: "audio/movin-crusin-cover1.mp3"
        , figure_scale: 15 // % of table-height, cc 15vh
        , figures: [
            { name: "Charlie", step: 0, kincs: false, imgsrc: "fig1c.png", img2src: "fig1d.png", img2step: 19 },
            { name: "Alan", step: 0, kincs: false, imgsrc: "fig2c.png", img2src: "fig2d.png", img2step: 19 },
            { name: "Frisco", step: 0, kincs: false, imgsrc: "fig4c.png", img2src: "fig4.png", img2step: 44 },
            { name: "Kalóz", step: 0, kincs: false, imgsrc: "fig5c.png", img2src: "fig5.png", img2step: 32 } ]
        , modes: [
            { id:1, match:'same', n1: 2, pairs: [3, 17, 7, 9, 13, 15], name:"Bugsy", desc:"Tudod mi vagy Bugsy?" },
            { id:2, match:'same', n1: 3, pairs: [2, 4, 5, 18, 7, 9, 10, 11, 12, 13, 15, 17], name:"Zsugabubus", desc:"Nem vagyok valami nagy játékos." },
            { id:3, match:'ab', n1: 3, pairs: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ], name:"Nimfas", desc: "Itt senki sem olyan nagy szám." },
            { id:4, match:'ab', n1: 4, pairs: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], name:"Charlie" },
            { id:5, match:'ab', n1: 4, pairs: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16], name:"Paragulis", desc:"Golyózott volna a szemed a trükkjeitől." }
        ]
        , messages: { intro: "Keresd a párját! Kettesével megnézheted a kártyákat.", 
                      step1: "Kattints egy kártyára!", 
                      step2: "Válasz egy másik kártyát!", 
                      evalPass: "Ügyes vagy!",
                      evalFail: "Próbáld újra!",
                      win: "Gratulálok!" }
        , ending: [ "Fantasztikus! Egyszerűen hihetetlen.", "Ilyet a fecskék is csak akkor csinálnak, ha jó formában vannak.",
                    "Az ajtók azért vannak, hogy bemenjünk rajtuk, nem tudtad?", "Hogy is mondjam, csak ez... olyan... mint... nem találok rá jelzőt.",
                    "Önök uraim egy rendkívül alapos nyomozói munka eredményei.", "Tudod mit? Furfangos egy furkó vagy te!",
                    "Te mondtad Főnök, olyan a szemem, mint a sasé!", "A te tudatalattid különleges tipikussággal jelentkezik."]

    };
    var gameData = {
        steps: [], turn: 0, aktiv: 0, players: [], started: false, pics: [], gameModeIdx:0, 
        state: "wait4first",  // "wait4first", "zoomOut1st", "wait4second", "zoomOut2nd", ""
        targetList: [],  // { id, img_src, posid }
        totalPairs: 0,
        foundPairs: [],
        attempts: 0,
        selectA: 0,
        selectB: 0,
        isPairFound: false,
        cookieNumPlays: 0,
        cookieBest: 0
    };
    var cookies = {      // arrays indexed per difficulty level
        started: [],     // games started
        finished: [],
        bestMoves: [],   // array of best moves per difficulty level
        bestTime: []
    };
    var gameUI = {
        mainAreaWidthPc: 80, mainAreaHeightPc: 90, // figureSizePc: 10,
        cardBackImg: "images/back.jpg",
        zoomedPosPc: 30, spingTimeMs:_shortMs, spinDeg:360,
        fullscr: 0, muted: false,
        cache: { imgSizePx: 100, offsetXPx:1, offsetYPx:1 }
    };

    function myLoad() {
        const queryString = window.location.search;
        if (queryString != '') {
            console.log(queryString);

            const urlParams = new URLSearchParams(queryString);
            if (urlParams.has('frameMs')) {
                frameMs = parseInt(urlParams.get('frameMs'))
            }
        }
    }

    function showAbout() {
        console.log(`About`)
        document.getElementById('selectModeDiv').style.display = 'none';
        document.getElementById('aboutDiv').style.display = 'inline';
        document.getElementById('tabla').style.filter = 'invert(25%)';
        var text = document.getElementById('texta');
        text.innerHTML = 'Nincs kettő négy nélkül!<br>'
                       + 'Egyszerű pűrkereső memóriajáték BSTH filmek rajongói számára.<br><br>'
                       + 'Játék terv, programmozás, blablala: szalabala<br>';
                       + 'Zene: xxx<br>';
                       + 'Köszönet: szalabala<br><br><br>';
        for (var i = 0; i < gameData.targetList.length; i++) {
            var pic = document.getElementById(gameData.targetList[i].id);
            var pos = getPosPxOfPospc(getEndingPosPcOf(gameData.targetList[i].posid));
            pic.style.transition=`transform ${gameUI.spingTimeMs}ms ease-in-out`; // linear ease 
            pic.style.transform=`translate(${pos.x}px, ${pos.y}px) scale(0.5, 0.5)`; // size:enlarge .. rotate:flip
        }

        for (var i = 0; i < gameDesc.modes.length; i++) {
            text.innerHTML += `${gameDesc.modes[i].name} mód: ${cookies.finished[i]} játék`
            if (cookies.finished[i] && cookies.finished[i] > 0) {
                text.innerHTML += `leg: ${cookies.bestMoves[i]} legjobb idő:${cookies.bestTime[i]}s`
            }
            text.innerHTML += ".<br>"
        }
        //disable all images
        // add some return button
        //windows.onClick = function() {}
    }

    function startOnce() {
        for (var i=1;i <= gameDesc.modes.length; i++ ) {
            addButton(i, 'selectModeDiv', i, '');
        }
        restoreCookies();
        start();
    }


    function start() {
        document.getElementById('tabla').src = gameDesc.tabla0;

        setTimeout(myResize, 10);  // initial placement

        console.log(`ss ${cookies.finished}`)
        for (var i=1;i <= gameDesc.modes.length; i++ ) {
            var but = document.getElementById(`b${i}`);
            but.style.display = 'initial';
            console.log(`sss ${i} ${cookies.finished} ${cookies.finished.length} ${cookies.finished[i-1]}`)
            if (i == 1 || (cookies.finished.length >= i && cookies.finished[i-2] > 0)) {
                but.disabled = false;
                but.style.color = 'darkgreen';
                but.style.border = '5px solid green';
                setTimeout(myBlink, 5 + i*300, but);
            } else {
                but.disabled = true;
                but.style.color = 'pink';
            }
        }

        /*
        for (var i=1;i < 2; i++ ) { // whatever
            //document.getElementById('p'+i).style.filter = 'invert(0%)';
            if (!(new URLSearchParams(window.location.search)).has('start')) {
                setTimeout(myBlink, 5 + i*200, "p"+i);
            }
        }
        */

        myLoad();
        //restartGame();
    }

    function selectMode(n=1) {
        console.log(`selectMode: ${n}`);

        gameData.gameModeIdx = n - 1;
        for (var i=1;i <= 5; i++ ) {
            document.getElementById(`b${i}`).style.display = 'none';
        }
        restartGame();
    }

    function showMode() {

    }

    function restartGame() {
        gameData.targetList = [];  // creating a random list of number, the pictures to show
        var mode = gameDesc.modes[gameData.gameModeIdx];
        gameDesc.numLongEdge = mode.n1 * 2;
        gameDesc.numShortEdge = mode.n1;
        var N = mode.n1 * mode.n1; //gameDesc.W * gameDesc.H;   //number of pairs to match
        var N2 = mode.pairs.length; //Math.floor(N / 2 );   //number of pairs to match
        var list = mode.pairs.slice();  // creating a random list of number, the pictures to show
        var poslist = [];
        gameData.totalPairs = 0;

        shuffle(list);

        for (var i = 0; i < 2*N; i++) { // random list of positions
            poslist.push(i);
        }
        shuffle(poslist);
        
        console.log(`start ${list} x ${poslist}`);
        for (var i = 0; i < N; i++) {  // add tiles
            var img2sel = (mode.match == 'same') ? 'a' : 'b';
            gameData.targetList.push( { id: `p${1+2*i}`, pairId: i, src: `images/${list[i]}a.jpg`, posid: poslist[i*2] } );
            gameData.targetList.push( { id: `p${2+2*i}`, pairId: i, src: `images/${list[i]}${img2sel}.jpg`, posid: poslist[i*2+1] } );
        }
        gameData.foundPairs = [];
        gameData.totalPairs = N;
        
        for (var i = 0; i < 2*N; i++) {
            addImage(gameData.targetList[i].id, gameUI.cardBackImg);// gameData.targetList[i].src);
        }
        setTimeout(myResize, 10);  // initial placement

        while (cookies.started.length <= gameData.gameModeIdx) {
            cookies.started.push(0);
        }
        cookies.started[gameData.gameModeIdx] += 1;
        storeCookies();
    }

    function onClickPic(id) {
        console.log(`click ${id}`);
        if (gameData.state == 'wait4first') {
            //if (gameData.foundPairs.find(element => element.id == id)) {}

            gameData.attempts += 1;
            gameData.selectA = id;
            gameData.state = "wait4second";
            gameData.isPairFound = false;
            var pos = getPosPxOfPospc( {x_pc:gameUI.zoomedPosPc, y_pc:50} );
            zoomOutPic(id, pos);
        } else if (gameData.state == 'wait4second' && id != gameData.selectA) {
            gameData.selectB = id;
            gameData.state = "evaluate";
            var pos = getPosPxOfPospc( {x_pc:(100-gameUI.zoomedPosPc), y_pc:50} );
            zoomOutPic(id, pos);
            setTimeout(evaluateSelection(), _longMs * 2);
        } else {

        }
    }
    function evaluateSelection() {
        console.log(`evaluate ${gameData.selectA} ? ${gameData.selectB}`);

        const itemA = gameData.targetList.find(element => element.id == gameData.selectA);
        const itemB = gameData.targetList.find(element => element.id == gameData.selectB);

        if (itemA.pairId == itemB.pairId) {
            gameData.foundPairs.push(itemA.pairId);
            gameData.isPairFound = true;
            document.getElementById(gameData.selectA).onclick = "";
            document.getElementById(gameData.selectB).onclick = "";
        }

        setMsg(`${cookies.started[gameData.gameModeIdx].started}. játék: eddig ${gameData.foundPairs} párt találtál meg a ${gameData.totalPairs}-ból.`);
        if (gameData.foundPairs.length < gameData.totalPairs) {
            setTimeout(changeState, _longMs, "wait4first");
        } else {
            setTimeout(playClosing, _longMs);
        }
    }

    function changeState(newState) {
        if (newState == "wait4first") {
            if (gameData.selectA != '') {
                zoomInPic(gameData.selectA);
            }
            if (gameData.selectB != '') {
                zoomInPic(gameData.selectB);
            }
            gameData.isPairFound = false;
        } else if (newState == "wait4first") {
            var pic = document.getElementById(selectAid);
            pic.classList.remove("med");
            pic.classList.add("top");
        }
        gameData.state = newState;
    }

    function playClosing() {
        console.log(`closing`)
        document.getElementById('tabla').style.filter = 'invert(25%)';
        for (var i = 0; i < gameData.targetList.length; i++) {
            var pic = document.getElementById(gameData.targetList[i].id);
            var pos = getPosPxOfPospc(getEndingPosPcOf(gameData.targetList[i].posid));
            pic.style.transition=`transform ${gameUI.spingTimeMs}ms ease-in-out`; // linear ease 
            pic.style.transform=`translate(${pos.x}px, ${pos.y}px) scale(0.5, 0.5)`; // size:enlarge .. rotate:flip
        }
        var r = Math.floor(Math.random() * gameDesc.ending.length);
        setMsg(gameDesc.ending[r],"bigtext");

        cookies.finished[gameData.gameModeIdx] += 1;
        storeCookies();
    }

    function zoomOutPic(id, pos) {
        var pic = document.getElementById(id);
        pic.classList.remove("med");
        pic.classList.add("top");
        pic.style.transition=`transform ${gameUI.spingTimeMs}ms ease-in-out`; // linear ease 
        pic.style.transform=`translate(${pos.x}px, ${pos.y}px) scale(2,2) rotateX(${gameUI.spinDeg}deg)`; // size:enlarge .. rotate:flip
        const item = gameData.targetList.find(element => element.id == id);
        setTimeout(swapPicImage, Math.floor(gameUI.spingTimeMs / 2), id, item.src);
        setTimeout(resetPicTransition, gameUI.spingTimeMs, id);
    }

    function zoomInPic(id) {
        var pic = document.getElementById(id);
        const item = gameData.targetList.find(element => element.id == id);
        var pos = getPosPxOfPospc(getPosPcOf(item.posid));
        pic.style.transition=`transform ${gameUI.spingTimeMs}ms ease-in-out`; // linear ease 
        pic.style.transform=`translate(${pos.x}px, ${pos.y}px) scale(1,1) rotateX(0deg)`; // size:enlarge .. rotate:flip
        if (false == gameData.isPairFound) {
            setTimeout(swapPicImage, Math.floor(gameUI.spingTimeMs / 2), id);
        }
        setTimeout(resetPicZindex, gameUI.spingTimeMs, id);
    }
    function resetPicZindex(id) {
        var pic = document.getElementById(id);
        pic.classList.remove("top");
        pic.classList.add("med");
        pic.style.transition='';
    }
    function resetPicTransition(id) {
        var pic = document.getElementById(id);
        pic.style.transition='';
    }

    function swapPicImage(id, imgsrc=gameUI.cardBackImg) {
        console.log(`swapPicImage ${id}`);
        var pic = document.getElementById(id);
        //const item = gameData.targetList.find(element => element.id == id);
        //addImage(gameData.targetList[i].id, gameData.targetList[i].src);
        pic.src = imgsrc;
    }

    function getPosPcOf(posId) { // return { xpc, ypc }s
        return {
            x_pc: Math.floor( ((100 - gameUI.mainAreaWidthPc) / 2) + ((posId % gameDesc.W) * (gameUI.mainAreaWidthPc) / (gameDesc.W -1))),
            y_pc: Math.floor( ((100 - gameUI.mainAreaHeightPc) / 2) + (Math.floor(posId / gameDesc.W) * (gameUI.mainAreaHeightPc / (gameDesc.H - 1))))
        };
    }

    function getEndingPosPcOf(idx) { // return { xpc, ypc }s
        if (gameDesc.W > gameDesc.H) {
            return { x_pc: Math.floor( 100 / (gameData.totalPairs - 1) * Math.floor(idx / 2) ), y_pc: Math.floor( (idx % 2 == 0) ? 0 : 100) };
        } else {
            return { x_pc: Math.floor( (idx % 2 == 0) ? 0 : 100), y_pc: Math.floor( 100/gameData.totalPairs * Math.floor(idx / 2) )};
        }
    }

    function getPosPxOfPospc( pos_pc, img=null ) {  // { xpc, ypc }
        var cw = document.documentElement.clientWidth;
        var ch = document.documentElement.clientHeight;
        var iw = (img ? img.clientWidth : gameUI.cache.imgSizePx);
        var ih = (img ? img.clientHeight : gameUI.cache.imgSizePx);

        console.log(`  pospc .. ${pos_pc.x_pc} ${pos_pc.y_pc}`);

        return {
            x: Math.floor((cw - iw) * pos_pc.x_pc / 100),  // + gameUI.OffsetXPx
            y: Math.floor((ch - ih) * pos_pc.y_pc / 100)   // + gameUI.OffsetYPx
        };
    }

    function addImage(id,isrc) {
        console.log(` add ${id} of ${isrc}`);
        //<button id="b3" class="xl modebutton" onClick="selectMode(3)">3</button>
        var img = document.createElement('img'); 
        img.id = id;
        img.src = isrc;
        img.classList.add("mozgo");
        img.classList.add("med");
        img.style.borderRadius = "25%";
        img.style.maxWidth = "30vw";
        img.style.maxHeight = "30vh";
        img.style.border = '2px solid white';
        img.onclick = function() { onClickPic(id); };
        document.getElementById('toptable').appendChild(img);
    }

    function addButton(idx,parent,text,defstyle) {
        console.log(` add ${idx}`);
        var but = document.createElement('button'); 
        but.id = `b${idx}`;
        but.classList.add("xl");
        but.classList.add("modebutton");
        but.onclick = function() { selectMode(idx); };
        but.innerHTML = text;
        document.getElementById(parent).appendChild(but);
    }


    function setStatusMsg(msg) {
        document.getElementById('status').innerHTML = msg;
    }
    function setMsg(msg, target="status") {
        document.getElementById(target).innerHTML = msg;
    }

    function myResize() {
        console.log(`resize`);
        var cw = document.documentElement.clientWidth;
        var ch = document.documentElement.clientHeight;
        var iw = window.innerWidth;

        var isAndroid = /(android)/i.test(navigator.userAgent);
        if (isAndroid) {
            document.getElementById('toptable').style.width = cw + 'px';
        } else {
            document.getElementById('toptable').style.width = iw + 'px';
        }

        if (cw > ch) {
            gameDesc.W = gameDesc.numLongEdge;
            gameDesc.H = gameDesc.numShortEdge;
        } else {
            gameDesc.W = gameDesc.numShortEdge;
            gameDesc.H = gameDesc.numLongEdge; 
        }

        var backimg = document.getElementById('tabla');
        var dh = backimg.offsetHeight;
        var r0 = backimg.naturalWidth / backimg.naturalHeight;
        var r = backimg.offsetWidth / backimg.offsetHeight;
        var tw = Math.floor(cw * gameUI.mainAreaWidthPercent / 100);
        var th = Math.floor(ch * gameUI.mainAreaHeightPercent / 100);
        var th0= Math.floor(tw / r0);
        var posCenter = getPosPxOfPospc( {x_pc:50, y_pc:50}, backimg );
        backimg.style.transform =`translate(${posCenter.x}px, ${posCenter.y}px)`;

        //var img_w = Math.floor( (cw * 80) / gameDesc.W / 100 );
        var img_maxw = Math.floor((cw * gameUI.mainAreaWidthPc / 100) / gameDesc.W);
        var img_maxh = Math.floor((ch * gameUI.mainAreaHeightPc / 100) / gameDesc.H);
        gameUI.cache.imgSizePx = Math.min(
            Math.floor( (cw * gameUI.mainAreaWidthPc / 100) / gameDesc.W ),
            Math.floor( (ch * gameUI.mainAreaHeightPc / 100) / gameDesc.H )
        );
        gameUI.cache.offsetXPx = Math.floor( (cw * (100-gameUI.mainAreaWidthPc) / 100) / 2 );
        gameUI.cache.offsetYPx = Math.floor( (ch * (100-gameUI.mainAreaHeightPc) / 100) / 2 );

        var N = gameDesc.W * gameDesc.H;   //number of images to match
        for (var i = 0; i < gameData.targetList.length; i++) {
            console.log(` r ${i} ${gameData.targetList[i].id}`)
            var pos = getPosPxOfPospc(getPosPcOf(gameData.targetList[i].posid));
            var img = document.getElementById(gameData.targetList[i].id);
            img.style.transition=''; // instant
            img.style.width = gameUI.cache.imgSizePx + 'px';
            img.style.height = gameUI.cache.imgSizePx + 'px';
//            img.style.maxWidth = gameUI.cache.imgSizePx + 'px';
//            img.style.maxHeight = gameUI.cache.imgSizePx + 'px';
            // instead of img.style.left img.style.top 
            img.style.transform=`translate(${pos.x}px, ${pos.y}px)`; // size:enlarge .. rotate:flip
            console.log(`  res ${i} ${gameData.targetList[i].id} ${img.style.left} ${img.style.top}` );
        }
    }
    function setStyle(elem,styleitem,value) {
        document.getElementById(elem).style.setProperty(styleitem,value);
    }
    function getPPosX(step,player=0) {
        return gameDesc.steps[step].x;
    }
    function getPPosY(playeridx=0) {
        return gameDesc.steps[players[gameData.players[playeridx]].step].y + (players[gameData.players[playeridx]].step==0 ? playeridx*15 : 0);
    }
    function myBlink(elem, isSet=true) {
        if (isSet) {
            elem.style.animation="blink1 2s infinite";
        } else {
            elem.style.removeAttribute('animation');
        }
        elem.style.tranform="none";
    }

    function toggleFullScr() {
        console.log(`full ${gameUI.fullscr}`)
        if (gameUI.fullscr == 0) {
            if ( document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if ( document.documentElement.webkitrequestFullscreen) {
                document.documentElement.webkitrequestFullscreen();
            } else if ( document.documentElement.mozrequestFullscreen) {
                document.documentElement.mozrequestFullscreen();
            } else if ( document.documentElement.msrequestFullscreen) {
                document.documentElement.msrequestFullscreen();
            }
            gameUI.fullscr = 1;
            document.getElementById("fullscr").src = "images/fullscr2b.png";
        } else {
            if ( document.documentElement.exitFullscreen) {
                document.documentElement.exitFullscreen();
            } else if ( document.documentElement.cancelFullscreen) {
                document.documentElement.cancelFullscreen();
            } else if ( document.documentElement.webkitexitFullscreen) {
                document.documentElement.webkitexitFullscreen();
            } else if ( document.documentElement.mozexitFullscreen) {
                document.documentElement.mozexitFullscreen();
            } else if ( document.documentElement.msexitFullscreen) {
                document.documentElement.msexitFullscreen();
            } else {
                alert('exit fullscreen, doesnt work');
            }
            gameUI.fullscr = 0;    
            document.getElementById("fullscr").src = "images/fullscr2a.png";
        }
        myResize();
        //setTimeout(function(){window.scrollTo(0, 0); }, 5);
    }

    function toggleAudio() {
      console.log(`mute:${gameUI.muted}`);
      if (gameUI.muted == false) {
            gameUI.muted = true;
            document.getElementById('myaudio').pause();
      } else {
            gameUI.muted = false;
            document.getElementById('myaudio').play();
      }
    }

    function debugPos(dx,dy,player=0) {
      idx=players[player].step
      gameDesc.steps[idx].x+=dx;
      gameDesc.steps[idx].y+=dy;
      movePlayerImg(player,idx);
      document.getElementById('status').innerHTML=`x:${gameDesc.steps[idx].x}, y:${gameDesc.steps[idx].y}`;
    }

    function shuffle(a) {
        var j, x, i;
        for (i = a.length - 1; i > 0; i--) {
            j = Math.floor(Math.random() * (i + 1));
            x = a[i];
            a[i] = a[j];
            a[j] = x;
        }
        return a;
    }

    function storeCookies() {
        bakeCookie('gamesStarted', cookies.started);
        bakeCookie('gamesFinished', cookies.finished);
        bakeCookie('bestMove', cookies.bestMove);
        bakeCookie('bestTime', cookies.bestTime);
    }
    function restoreCookies() {
        cookies.started = readCookieA('gamesStarted');
        cookies.finished = readCookieA('gamesFinished');
        cookies.bestMove = readCookieA('bestMove');
        cookies.bestTime = readCookieA('bestTime');

        while (cookies.started.length <= gameDesc.modes.length) {
            cookies.started.push(0);
        }
        while (cookies.finished.length <= gameDesc.modes.length) {
            cookies.finished.push(0);
        }
    }

    function bakeCookie(name, value) {
        //var cookiestr = [name, '=', JSON.stringify(value), '; domain=.', window.location.host.toString(), '; path=/;'].join('');
        //var cookiestr = `${name}=${encodeURIComponent(JSON.stringify(value))};max-age=${1000*24*60*60*1000};domain=.${window.location.host.toString()}.com:; path=/;`;
        var cookiestr = `${name}=${encodeURIComponent(JSON.stringify(value))};max-age=${1000*24*60*60*1000};path=/;`;
        document.cookie = cookiestr;
        console.log(` store cookie ${cookiestr}`);
    }
    function deleteCookie(name) {
        var cookiestr = `${name}=;max-age=0;path=/;`;
        document.cookie = cookiestr;
        console.log(` delete cookie ${cookiestr}`);
    }

    function readCookieA(name) {
        var result = document.cookie.match(new RegExp(name + '=([^;]+)'));

        if (result) {
            console.log(` load cookie1 ${name} : ${result}`);
            console.log(` load cookie2 ${name} : ${decodeURIComponent(result[1])}`);
            console.log(` load cookie3 ${name} : ${JSON.parse(decodeURIComponent(result[1]))}`);
        
            result = JSON.parse(decodeURIComponent(result[1]));
        } else {
            result = [];
        }

        console.log(` load cookie ${name} : ${result}`);

        return result;
    }
    function setCookie(name, value) {
        var cookiestr = `${name}=${encodeURIComponent(value)};max-age=${1000*24*60*60*1000};path=/`; //;path=/lovas12/nincs2
        console.log(` set cookie ${cookiestr}`);
        document.cookie = cookiestr; //;path=/lovas12/nincs2
    }
    function getCookie(name) {
        var cookieArr = document.cookie.split(";");
        console.log(`xx${document.cookie}xx`);
        for (var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split("=");
            if (name == cookiePair[0].trim()) {
                return decodeURIComponent(cookiePair[1]);
            }
        }
        return null;
    }
/*width:10%;height:10%;padding:0;display:inline-block;
display:inline-block;
*/
</script>
</head>
<body onload="startOnce();" onresize="myResize();">
    <audio id="myaudio" src="audio/movin-cruisin-xylo.mp3" autoplay loop> </audio>
    <div id="toptable" style="position:absolute;width:100%;height:100%;padding:0;">
        <img id="tabla" class="back" src="images/nincs2header_46.jpg" style="position:absolute;float:left;left:0;padding:0;text-align:center;vertical-align:top;width:90%;height:90%;max-height:90vh;max-width:90vw;z-index:-1;object-fit:contain;object-position:center center;">
        <div style="position:relative;float:right;width:90%;text-align:right;vertical-align:top;">
            <p id='volume' style="text-align:right"><img src="images/volume2a.png" style="max-height:4vmin" onclick="toggleAudio()"><img id='fullscr' src="images/fullscr2a.png" style="max-height:5vmin" onclick="toggleFullScr()">
            <br><img src="images/about.png" style="max-height:4vmin" onclick="showAbout()"></p>
        </div>
        <div id="selectModeDiv" style="position:fixed;float:left;left:10%;top:35%;width:80%;padding:0;text-align:center;">
            <p id="bigtext" class="xl" style="text-align:center;font-stretch:semi-condensed;">Nincs kettő négy nélkül!</p><br>
        </div>
        <div id="aboutDiv" style="position:fixed;float:left;left:10%;top:25%;width:80%;padding:0;text-align:center;display:none;">
            <p id="texta" class="small" style="padding:0;text-align:left;font-stretch:semi-condensed;"></p>
        </div>
        <p id="status" class="medium" style="position:fixed;float:left;left:0%;bottom:0%;width:50%;padding:0;text-align:left;font-stretch:semi-condensed;">
        <a href="https://www.buymeacoffee.com/szalabala" target="_blank"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=&slug=szalabala&button_colour=FFDD00&font_colour=000000&font_family=Cookie&outline_colour=000000&coffee_colour=ffffff"></a></p>
        <p id="credit" class="medium" style="position:fixed;float:right;right:0%;bottom:0%;width:90%;padding:0;text-align:right;font-stretch:semi-condensed;"><i>&copy; Copyright 2021 szalabala - grafika: TBD</i></p>
    </div>
    <!--https://www.buymeacoffee.com/szalabala
        <p id="status" class="medium" style="position:fixed;float:left;left:0%;bottom:0%;width:50%;padding:0;text-align:left;font-stretch:semi-condensed;"><a href="https://www.buymeacoffee.com/szalabala" target="_blank"><img style="max-height:5vh" src="images/buymeacoffee.png"></a></p>
        <img id="tabla" class="back" src="data:," style="position:absolute;float:left;left:0;padding:0;text-align:center;vertical-align:top;max-height:99vh;max-width:99vw;z-index:-1;object-fit:contain;object-position:center center;">
        <div style="position:absolute;float:left;max-height:15%;max-width:75%;text-align:center;top:50%;left:10%;transform-origin:bottom left;transform:rotate(-90deg);">
            <h2>Nincs kettő négy nélkül</h2>
        </div>
    -->
</body>
    </html>
